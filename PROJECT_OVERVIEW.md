# Twitter Microservices Project

## Общее описание проекта

**Twitter** — это микросервисная платформа для социальной сети, построенная на современном технологическом стеке Java 24 и Spring Boot 3. Проект реализует архитектуру монорепозитория с разделением на независимые микросервисы и общие библиотеки.

### Ключевые бизнес-задачи

- **Управление пользователями**: Регистрация, аутентификация, профили пользователей
- **Контент-менеджмент**: Создание, публикация и модерация контента
- **Социальные функции**: Подписки, лайки, комментарии, репосты
- **Модерация**: Система ролей и прав доступа для модераторов и администраторов
- **Аналитика**: Сбор метрик и аналитических данных

### Основные технологии

| Технология | Версия | Назначение |
|------------|--------|------------|
| **Java** | 24 | Основной язык программирования |
| **Spring Boot** | 3.5.5 | Микросервисный фреймворк |
| **Spring Data JPA** | 3.x | Работа с базой данных |
| **PostgreSQL** | 15 | Основная база данных |
| **Docker** | Latest | Контейнеризация |
| **Gradle** | Latest | Система сборки |
| **MapStruct** | 1.6.3 | Маппинг объектов |
| **Lombok** | 1.18.38 | Генерация кода |
| **Micrometer** | Latest | Мониторинг и метрики |
| **TestContainers** | 1.21.3 | Интеграционное тестирование |

### Управление зависимостями

Проект использует **централизованное управление версиями зависимостей** через `dependencyManagement` в корневом `build.gradle`. 

**Управляемые зависимости:**
- Spring Boot BOM (автоматически)
- Lombok, MapStruct, Swagger, PostgreSQL драйвер
- TestContainers BOM (автоматически)

## Архитектура проекта

### Общая архитектура

Проект построен по принципу **микросервисной архитектуры** с разделением на:

- **Сервисы** (`services/`) — независимые микросервисы с собственной бизнес-логикой
- **Общие библиотеки** (`shared/`) — переиспользуемые компоненты
- **Инфраструктура** — конфигурации для развертывания и мониторинга

### Схема архитектуры

```
┌─────────────────────────────────────────────────────────────────┐
│                        Twitter Platform                         │
├─────────────────────────────────────────────────────────────────┤
│  ┌─────────────────────────────────────────────────────────────┐ │
│  │                    Services Layer                           │ │
│  │  ┌─────────────────────────────────────────────────────────┐ │ │
│  │  │              Users API (Port 8080)                     │ │ │
│  │  │  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐    │ │ │
│  │  │  │ Controller  │  │  Service    │  │ Repository  │    │ │ │
│  │  │  │   Layer     │  │   Layer     │  │   Layer     │    │ │ │
│  │  │  └─────────────┘  └─────────────┘  └─────────────┘    │ │ │
│  │  └─────────────────────────────────────────────────────────┘ │ │
│  └─────────────────────────────────────────────────────────────┘ │
│                               │                                 │
│  ┌─────────────────────────────────────────────────────────────┐ │
│  │                Shared Libraries                               │ │
│  │  ┌─────────────────┐  ┌─────────────────┐                   │ │
│  │  │   Common Lib    │  │   Database      │                   │ │
│  │  │   - Logging     │  │   - Entities    │                   │ │
│  │  │   - Exceptions  │  │   - Repos      │                   │ │
│  │  │   - AOP         │  │   - Configs    │                   │ │
│  │  └─────────────────┘  └─────────────────┘                   │ │
│  └─────────────────────────────────────────────────────────────┘ │
│                               │                                 │
│  ┌─────────────────────────────────────────────────────────────┐ │
│  │                Infrastructure Layer                          │ │
│  │  ┌─────────────────┐  ┌─────────────────┐                   │ │
│  │  │   PostgreSQL    │  │   Docker        │                   │ │
│  │  │   (Port 5432)   │  │   Compose       │                   │ │
│  │  └─────────────────┘  └─────────────────┘                   │ │
│  └─────────────────────────────────────────────────────────────┘ │
└─────────────────────────────────────────────────────────────────┘
```

### Взаимодействие сервисов

**Текущая реализация:**
- **REST API** — синхронное взаимодействие через HTTP
- **База данных** — каждый сервис имеет доступ к общей PostgreSQL
- **Общие библиотеки** — статическое связывание через Gradle

**Планируемое развитие:**
- **gRPC** — для высокопроизводительного взаимодействия между сервисами
- **Apache Kafka** — для асинхронной обработки событий
- **Spring Cloud** — для service discovery и конфигурации
- **API Gateway** — для маршрутизации и аутентификации

## Структура монорепозитория

```
twitter/
├── 📁 build/                    # Результаты сборки
├── 📁 compose/                  # Docker Compose конфигурации
│   └── postgre.yaml            # Конфигурация PostgreSQL
├── 📁 docs/                     # Документация проекта
├── 📁 logs/                     # Логи приложений
├── 📁 pictures/                 # Диаграммы и изображения
│   └── architecture_1.png      # Схема архитектуры
├── 📁 scripts/                  # Скрипты автоматизации
├── 📁 services/                 # Микросервисы
│   └── 📁 users-api/           # Сервис управления пользователями
│       ├── 📁 src/              # Исходный код
│       ├── 📁 build/            # Результаты сборки сервиса
│       ├── Dockerfile           # Docker образ сервиса
│       └── README.md            # Документация сервиса
├── 📁 shared/                   # Общие библиотеки
│   ├── 📁 common-lib/           # Общие компоненты
│   │   ├── 📁 src/              # Исходный код библиотеки
│   │   ├── build.gradle         # Конфигурация сборки
│   │   └── README.md            # Документация библиотеки
│   └── 📁 database/             # Компоненты работы с БД
│       ├── 📁 src/              # Исходный код
│       └── build.gradle         # Конфигурация сборки
├── 📁 sql/                      # SQL скрипты
│   └── users.sql               # Схема таблицы пользователей
├── 📁 todo/                     # Планы развития
│   ├── TODO_Gemini.md          # Планы для Gemini
│   ├── TODO_GPT5.md            # Планы для GPT-5
│   ├── TODO_PATH.md            # Планы развития
│   └── TODO_PLANS.md           # Общие планы
├── build.gradle                # Корневая конфигурация Gradle
├── docker-compose.yml          # Docker Compose для разработки
├── gradle.properties           # Свойства Gradle
├── settings.gradle             # Настройки проекта
├── gradlew                     # Gradle Wrapper (Unix)
└── gradlew.bat                 # Gradle Wrapper (Windows)
```

### Описание модулей

#### Сервисы (`services/`)

- **`users-api`** — микросервис управления пользователями
  - REST API для CRUD операций с пользователями
  - Ролевая модель (USER, ADMIN, MODERATOR)
  - Безопасное хеширование паролей
  - Валидация и фильтрация данных

#### Общие библиотеки (`shared/`)

- **`common-lib`** — общие компоненты для всех сервисов
  - Логирование HTTP запросов (`@LoggableRequest`)
  - Глобальная обработка исключений
  - Аспектно-ориентированное программирование (AOP)
  - Специализированные исключения

- **`database`** — компоненты работы с базой данных
  - Общие сущности JPA
  - Репозитории и спецификации
  - Конфигурации подключения к БД

## Сборка и запуск

### Требования

- **Java 24** — основной язык разработки
- **Docker** — для контейнеризации
- **Docker Compose** — для локальной разработки
- **Gradle** — система сборки (включен Gradle Wrapper)

### Сборка проекта

#### Сборка всех модулей
```bash
# Сборка всего проекта
./gradlew build

# Сборка с пропуском тестов (быстрее)
./gradlew build -x test

# Сборка конкретного сервиса
./gradlew :services:users-api:build
```

#### Управление зависимостями

**Обновление версий зависимостей:**
```bash
# Обновление версии в корневом build.gradle
# Измените версию в dependencyManagement блоке

# Проверка зависимостей
./gradlew dependencies

# Обновление зависимостей
./gradlew --refresh-dependencies build
```

**Добавление новой зависимости:**
1. Добавьте версию в `dependencyManagement` корневого `build.gradle`
2. Добавьте зависимость без версии в нужный подпроект
3. Запустите `./gradlew build` для проверки

**Пример добавления зависимости:**
```gradle
// В корневом build.gradle (dependencyManagement)
dependencyManagement {
    dependencies {
        dependency 'com.example:new-library:1.2.3'
    }
}

// В подпроекте (без версии)
dependencies {
    implementation 'com.example:new-library'
}
```

#### Сборка Docker образов
```bash
# Сборка образа users-api
docker build -f services/users-api/Dockerfile -t twitter-users-api .

# Сборка всех образов через Docker Compose
docker-compose build

# Сборка и развертывание всего сразу (рекомендуется)
docker-compose up -d --build
```

### Локальный запуск

#### Вариант 1: Docker Compose (рекомендуется)
```bash
# Запуск всей инфраструктуры
docker-compose up -d

# Просмотр логов
docker-compose logs -f users-api

# Остановка
docker-compose down
```

#### Вариант 2: Локальная разработка
```bash
# 1. Запуск PostgreSQL
docker-compose up -d postgres

# 2. Запуск сервиса
./gradlew :services:users-api:bootRun

# Или через IDE
# Запустить Application.java в services/users-api/src/main/java/com/twitter/
```

## Деплой и окружения

### CI/CD Пайплайн (планируется)

#### Основные шаги деплоя

1. **Сборка и тестирование**
   ```bash
   ./gradlew clean build
   ./gradlew test
   ```

2. **Создание Docker образа**
   ```bash
   docker build -f services/users-api/Dockerfile -t twitter-users-api:latest .
   ```

## Ссылки

### Документация сервисов

- **[Users API](services/users-api/README.md)** — документация сервиса управления пользователями
- **[Common Library](shared/common-lib/README.md)** — документация общей библиотеки

### Внешние ресурсы

- **Spring Boot Documentation**: https://spring.io/projects/spring-boot
- **PostgreSQL Documentation**: https://www.postgresql.org/docs/
- **Docker Documentation**: https://docs.docker.com/
- **Gradle Documentation**: https://docs.gradle.org/

### Архитектурные решения

- **ADR (Architecture Decision Records)** — планируется создание папки `docs/adr/`
- **Wiki** — планируется интеграция с корпоративным Wiki
- **Confluence** — планируется интеграция с Confluence

---

## Быстрый старт

1. **Клонирование репозитория**
   ```bash
   git clone <repository-url>
   cd twitter
   ```

2. **Запуск инфраструктуры**
   ```bash
   docker-compose up -d --build
   ```

3. **Проверка работы**
   ```bash
   curl http://localhost:8080/actuator/health
   ```

4. **Документация API**
   - Swagger UI: `http://localhost:8080/swagger-ui.html` (планируется)
   - OpenAPI Spec: `http://localhost:8080/v3/api-docs` (планируется)

---

*Последнее обновление: $(date)*
*Версия документа: 1.0*
