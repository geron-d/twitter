# TODO

## Meta
- project: twitter-users-api
- updated: 2025-01-21
- changelog: todo/CHANGELOG.md

## Tasks

### Анализ и планирование
- [x] (P1) [2025-01-21 20:15] #1: Анализ текущей архитектуры User entity — Изучить существующую структуру User.java, DTOs, мапперы и сервисы
  acceptance: "Понять все компоненты, которые нужно обновить для добавления createdAt"
  note: "Проанализированы все компоненты: User entity, 4 DTOs, UserMapper, UserService, UserController, SQL схема"
- [x] (P1) [2025-01-21 20:18] #2: Определение стратегии автоматического заполнения createdAt — Выбрать подход для автоматической установки даты создания
  acceptance: "Выбрать между @PrePersist, @CreationTimestamp или ручной установкой в сервисе"
  note: "Выбрана стратегия @CreationTimestamp - простая, надёжная, совместимая с Hibernate"

### Изменения в базе данных
- [x] (P1) [2025-01-21 20:22] #3: Обновление SQL скрипта users.sql — Добавить поле created_at в таблицу users
  acceptance: "Добавить поле created_at TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP"
  note: "Добавлено поле created_at TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP в конец таблицы"
- [ ] (P2) #4: Создание миграции для существующих данных — Подготовить скрипт для обновления существующих записей
  acceptance: "Скрипт для установки created_at для существующих пользователей"

### Изменения в Entity
- [x] (P1) [2025-01-21 20:25] #5: Добавление поля createdAt в User.java — Добавить LocalDateTime createdAt с соответствующими аннотациями
  acceptance: "Поле добавлено с @Column, @CreationTimestamp или @PrePersist"
  note: "Добавлено поле createdAt с @CreationTimestamp, updatable=false, полная JavaDoc документация"
- [ ] (P1) #6: Обновление конструкторов и методов User.java — Обновить AllArgsConstructor и другие методы
  acceptance: "Все конструкторы и методы работают корректно с новым полем"

### Изменения в DTOs
- [ ] (P1) #7: Обновление UserResponseDto — Добавить поле createdAt в ответный DTO
  acceptance: "Поле createdAt включено в UserResponseDto с правильными аннотациями Swagger"
- [ ] (P2) #8: Проверка других DTOs — Убедиться, что createdAt не попадает в Request/Update DTOs
  acceptance: "createdAt отсутствует в UserRequestDto, UserUpdateDto, UserPatchDto"

### Изменения в мапперах
- [ ] (P1) #9: Обновление UserMapper — Проверить и обновить маппинг для включения createdAt
  acceptance: "MapStruct корректно маппит поле createdAt из Entity в ResponseDto"
- [ ] (P2) #10: Обновление тестов маппера — Добавить тесты для проверки маппинга createdAt
  acceptance: "Тесты проверяют корректность маппинга поля createdAt"

### Изменения в сервисах
- [ ] (P1) #11: Проверка UserService — Убедиться, что сервис корректно работает с новым полем
  acceptance: "Все методы сервиса работают без изменений, createdAt заполняется автоматически"
- [ ] (P2) #12: Обновление тестов сервиса — Добавить проверки для createdAt в тестах
  acceptance: "Тесты проверяют, что createdAt устанавливается при создании пользователя"

### Изменения в контроллерах
- [ ] (P1) #13: Проверка UserController — Убедиться, что контроллер возвращает createdAt
  acceptance: "Все эндпоинты возвращают createdAt в ответах"
- [ ] (P2) #14: Обновление тестов контроллера — Добавить проверки createdAt в интеграционных тестах
  acceptance: "Тесты проверяют наличие createdAt в HTTP ответах"

### Обновление документации
- [ ] (P1) #15: Обновление Swagger документации — Добавить createdAt в OpenAPI схемы
  acceptance: "Swagger UI показывает поле createdAt в UserResponse"
- [ ] (P1) #16: Обновление README.md — Добавить информацию о поле createdAt
  acceptance: "README содержит описание поля createdAt в примерах API"
- [ ] (P1) #17: Обновление README_eng.md — Добавить информацию о поле createdAt в английской версии
  acceptance: "README_eng содержит описание поля createdAt в примерах API"

### Тестирование и валидация
- [ ] (P1) #18: Запуск всех тестов — Проверить, что все существующие тесты проходят
  acceptance: "Все unit и integration тесты проходят успешно"
- [ ] (P1) #19: Ручное тестирование API — Проверить работу API через Swagger UI
  acceptance: "Создание пользователя возвращает createdAt, все эндпоинты работают"
- [ ] (P2) #20: Проверка базы данных — Убедиться, что поле корректно сохраняется в БД
  acceptance: "Поле created_at корректно заполняется в таблице users"

### Дополнительные проверки
- [ ] (P2) #21: Проверка фильтрации — Убедиться, что можно фильтровать по дате создания
  acceptance: "UserFilter поддерживает фильтрацию по createdAt (если требуется)"
- [ ] (P2) #22: Проверка сортировки — Убедиться, что можно сортировать по дате создания
  acceptance: "API поддерживает сортировку по createdAt"
- [ ] (P3) #23: Проверка производительности — Убедиться, что добавление поля не влияет на производительность
  acceptance: "Время ответа API не изменилось значительно"

## Assumptions
- Поле createdAt будет заполняться автоматически при создании пользователя
- Поле createdAt не будет редактироваться после создания
- Поле createdAt будет включено только в Response DTOs, не в Request DTOs
- Используется LocalDateTime для хранения даты и времени
- Существующие пользователи получат текущую дату как дату создания
- Поле будет отображаться в Swagger документации

## Notes
- Поле createdAt является системным и не должно быть доступно для редактирования через API
- Необходимо убедиться, что все существующие тесты продолжают работать
- Важно проверить совместимость с существующими клиентами API
- Рассмотреть возможность добавления индекса на поле created_at для оптимизации запросов
- Возможно потребуется обновить Postman коллекции для включения нового поля

## Риски и ограничения
- **Риск**: Существующие тесты могут сломаться из-за изменения структуры DTO
- **Риск**: Клиенты API могут не ожидать новое поле в ответах
- **Ограничение**: Поле createdAt не может быть изменено после создания пользователя
- **Ограничение**: Необходимо обработать существующие записи в базе данных

## Критерии успешности
- Все тесты проходят успешно
- API возвращает поле createdAt в ответах
- Swagger документация обновлена
- README файлы содержат актуальную информацию
- Поле корректно сохраняется в базе данных
- Производительность API не ухудшилась
