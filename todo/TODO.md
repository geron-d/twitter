# TODO: Централизация версий зависимостей в Gradle

## Meta
- project: Twitter Microservices Monorepo
- updated: 2025-01-27
- changelog: todo/CHANGELOG.md
- priority: P1 (Critical Infrastructure)

## Tasks

### Done
- [x] (P1) #1: Анализ текущей структуры зависимостей — Проанализированы build.gradle файлы корневого проекта, users-api и common-lib
  acceptance: "Выявлены дублирующиеся версии зависимостей в подпроектах"

### In Progress
- [ ] (P1) #2: Создание централизованного управления версиями — Определение стратегии версионирования
  acceptance: "Все версии зависимостей вынесены в корневой build.gradle"

### To Do
- [ ] (P1) #3: Рефакторинг корневого build.gradle — Добавление ext блоков для версий
  acceptance: "Создан ext блок с версиями всех зависимостей"
  
- [ ] (P1) #4: Обновление users-api/build.gradle — Замена хардкодных версий на переменные
  acceptance: "Все версии заменены на ссылки на корневые переменные"
  
- [ ] (P1) #5: Обновление common-lib/build.gradle — Замена хардкодных версий на переменные
  acceptance: "Все версии заменены на ссылки на корневые переменные"
  
- [ ] (P2) #6: Валидация сборки — Проверка корректности сборки всех модулей
  acceptance: "Все модули собираются без ошибок"
  
- [ ] (P2) #7: Обновление документации — Обновление README файлов с новой структурой
  acceptance: "Документация отражает новую структуру управления зависимостями"
  
- [ ] (P3) #8: Создание скрипта проверки версий — Автоматическая проверка консистентности версий
  acceptance: "Скрипт проверяет отсутствие дублирующихся версий"

## Assumptions
- Проект использует Gradle с Spring Boot 3.5.5
- Все подпроекты должны использовать одинаковые версии зависимостей
- Необходимо сохранить обратную совместимость
- Версии Spring Boot уже централизованы через dependencyManagement
- Lombok, MapStruct, Swagger и PostgreSQL драйвер требуют централизации

## Risks & Mitigation
- **Риск**: Нарушение сборки при изменении версий
  - **Митигация**: Поэтапное внедрение с тестированием на каждом шаге
  
- **Риск**: Конфликты версий между модулями
  - **Митигация**: Использование dependencyManagement для управления транзитивными зависимостями
  
- **Риск**: Усложнение процесса обновления зависимостей
  - **Митигация**: Создание четкой документации по процессу обновления

## Dependencies Analysis
### Текущие дублирующиеся версии:
- `swagger-annotations: 2.2.38` (users-api, common-lib)
- `springdoc-openapi-starter-webmvc-ui: 2.8.13` (users-api, common-lib)
- `lombok: 1.18.38` (users-api, common-lib)
- `mapstruct: 1.6.3` (users-api, common-lib)
- `mapstruct-processor: 1.6.3` (users-api, common-lib)
- `lombok-mapstruct-binding: 0.2.0` (users-api, common-lib)
- `postgresql: 42.7.7` (users-api)

## Implementation Strategy
1. **Централизация через ext блок** - создание переменных версий в корневом build.gradle
2. **Поэтапное внедрение** - обновление одного модуля за раз
3. **Валидация на каждом шаге** - проверка сборки после каждого изменения
4. **Документирование процесса** - создание руководства по обновлению версий

## Success Criteria
- Все версии зависимостей управляются из корневого build.gradle
- Отсутствуют дублирующиеся версии в подпроектах
- Все модули собираются успешно
- Процесс обновления зависимостей упрощен и документирован

## Notes
- Использовать Gradle ext блок для определения версий
- Рассмотреть возможность использования gradle.properties для версий
- Обеспечить совместимость с существующим dependencyManagement
- Подготовить rollback план на случай проблем
