# TODO

## Meta
- project: Twitter Users API - OpenAPI/Swagger Documentation
- updated: 2025-01-27
- changelog: todo/CHANGELOG.md

## Tasks

### Analysis & Planning
- [x] (P1) #1: Анализ существующего users-api сервиса — Изучение архитектуры, эндпоинтов, DTO и бизнес-логики  
  acceptance: "Понять структуру API, входные/выходные данные, валидацию и обработку ошибок"
- [x] (P1) #2: Создание детального плана разработки OpenAPI документации — Структурирование задач и этапов  
  acceptance: "Четкий план с приоритетами и критериями готовности"

### Implementation
- [x] (P1) [2025-01-27 15:30] #3: Настройка SpringDoc OpenAPI конфигурации — Добавление зависимостей и базовой конфигурации  
  acceptance: "SpringDoc OpenAPI работает, доступен Swagger UI"
  note: "Добавлена зависимость SpringDoc OpenAPI 2.2.0, создан OpenApiConfig, настроен application.yml"
- [x] (P1) [2025-01-27 16:00] #4: Добавление OpenAPI аннотаций к UserController — Описание всех эндпоинтов с деталями  
  acceptance: "Все 7 эндпоинтов описаны с параметрами, ответами и примерами"
  note: "Создан интерфейс UserApi с OpenAPI аннотациями, UserController реализует интерфейс"
- [x] (P1) [2025-01-27 16:15] #5: Создание схем для DTO классов — Описание UserRequestDto, UserResponseDto, UserUpdateDto и др.  
  acceptance: "Все DTO имеют полные схемы с валидацией и примерами"
  note: "Добавлены аннотации @Schema ко всем DTO с описаниями, примерами и валидацией"
- [x] (P1) [2025-01-27 16:45] #6: Создание схем для обработки ошибок — Описание ValidationException и других исключений  
  acceptance: "Схемы ошибок соответствуют GlobalExceptionHandler"
  note: "Добавлена зависимость SpringDoc в common-lib, добавлены аннотации @Schema к классам исключений"
- [x] (P1) [2025-01-27 17:00] #7: Добавление аннотаций к перечислениям — Описание UserRole и UserStatus  
  acceptance: "Enums описаны с пояснениями значений"
  note: "Добавлены аннотации @Schema к UserRole и UserStatus с описаниями всех значений"

### Testing & Validation
- [ ] (P2) #8: Тестирование OpenAPI документации — Проверка корректности схем и примеров  
  acceptance: "Swagger UI отображает корректную документацию, примеры работают"
- [ ] (P2) #9: Валидация соответствия API и документации — Сравнение с реальными эндпоинтами  
  acceptance: "Документация точно отражает поведение API"
- [ ] (P2) #10: Тестирование генерации клиентского кода — Проверка возможности генерации SDK  
  acceptance: "Можно сгенерировать клиентский код для основных языков"

### Documentation & Deployment
- [ ] (P3) #11: Создание дополнительной документации — README с примерами использования API  
  acceptance: "Документация содержит примеры запросов и ответов"
- [ ] (P3) #13: Создание Postman коллекции — Экспорт API в Postman для тестирования  
  acceptance: "Postman коллекция содержит все эндпоинты с примерами"

## Assumptions
- Используется SpringDoc OpenAPI 3 (современная альтернатива Swagger 2)
- Документация будет доступна через Swagger UI на `/swagger-ui.html`
- OpenAPI спецификация будет доступна на `/v3/api-docs`
- Сохраняется существующая архитектура и не нарушается обратная совместимость
- Документация будет на английском языке для международной аудитории
- Поддерживается генерация клиентского кода для основных языков программирования

## Technical Requirements
- SpringDoc OpenAPI 3 dependency
- Аннотации: @Operation, @ApiResponse, @Schema, @Parameter
- Схемы для всех DTO с валидацией
- Схемы для ошибок (400, 404, 409, 500)
- Примеры запросов и ответов
- Описание пагинации и фильтрации
- Документация ролевой модели и бизнес-правил

## API Endpoints to Document
1. `GET /api/v1/users/{id}` - Получить пользователя по ID
2. `GET /api/v1/users` - Получить список пользователей с фильтрацией и пагинацией
3. `POST /api/v1/users` - Создать нового пользователя
4. `PUT /api/v1/users/{id}` - Полное обновление пользователя
5. `PATCH /api/v1/users/{id}` - Частичное обновление пользователя
6. `PATCH /api/v1/users/{id}/inactivate` - Деактивировать пользователя
7. `PATCH /api/v1/users/{id}/role` - Обновить роль пользователя

## DTOs to Document
- UserRequestDto - создание пользователя
- UserResponseDto - ответ с данными пользователя
- UserUpdateDto - полное обновление
- UserRoleUpdateDto - обновление роли
- UserFilter - фильтрация пользователей
- PagedModel<UserResponseDto> - пагинированный ответ

## Error Schemas to Document
- ValidationException (400) - ошибки валидации
- UniquenessValidationException (409) - дублирование данных
- BusinessRuleValidationException (400) - нарушение бизнес-правил
- FormatValidationException (400) - ошибки формата
- ConstraintViolationException (400) - Bean Validation ошибки
- Generic RuntimeException (500) - внутренние ошибки

## Notes
- Документация должна быть самодостаточной и понятной для разработчиков
- Примеры должны быть реалистичными и отражать реальные сценарии использования
- Особое внимание к безопасности - не показывать чувствительные данные в примерах
- Документировать бизнес-правила (защита последнего админа, валидация ролей)
- Поддержка версионирования API для будущих изменений
- Интеграция с существующей системой логирования и мониторинга

## Risks & Mitigation
- **Риск**: Нарушение существующей функциональности при добавлении аннотаций
  - **Митигация**: Тщательное тестирование после каждого изменения
- **Риск**: Несоответствие документации реальному поведению API
  - **Митигация**: Автоматизированное тестирование соответствия
- **Риск**: Производительность при генерации документации
  - **Митигация**: Оптимизация аннотаций и кэширование схем
- **Риск**: Сложность поддержки документации при изменениях API
  - **Митигация**: Интеграция в CI/CD pipeline для автоматического обновления

## Success Criteria
- Swagger UI доступен и корректно отображает все эндпоинты
- Все схемы DTO содержат полную информацию о полях и валидации
- Примеры запросов и ответов работают корректно
- Документация покрывает все сценарии использования API
- Возможна генерация клиентского кода для основных языков
- Документация интегрирована в процесс разработки и обновляется автоматически
