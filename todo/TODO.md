# TODO

## Meta
- project: twitter-users-api-pagination-default
- updated: 2025-01-21
- changelog: todo/CHANGELOG.md

## Tasks

### Done
- [x] (P1) #1: Анализ текущего состояния пагинации — Проанализирована текущая реализация пагинации в UserController.findAll()
  acceptance: "Понять как работает текущая пагинация и где отсутствуют настройки по умолчанию"
- [x] (P1) [2025-01-21 15:30] #2: Определить оптимальные значения пагинации по умолчанию — Определен размер страницы и максимальный размер
  acceptance: "Определены разумные значения: size=10, maxSize=100"
  note: "Проанализированы Spring Data Web best practices, производительность и UX. Выбраны оптимальные значения: дефолт 10 элементов (лучший UX), максимум 100 элементов (защита от злоупотреблений)"
- [x] (P1) [2025-01-21 15:45] #3: Исследовать Spring Data Web настройки — Изучены возможности конфигурации пагинации через application.yml
  acceptance: "Понять возможности spring.data.web.pageable.* настроек"
  note: "Найдены настройки: default-page-size, max-page-size, page-parameter, size-parameter, sort-parameter, prefix, qualifier-delimiter. Spring Boot 3.5.5 поддерживает все эти настройки"
- [x] (P1) [2025-01-21 16:00] #4: Проанализировать влияние на существующие тесты — Проверены тесты, которые могут сломаться при изменении дефолтных значений
  acceptance: "Выявлены тесты, которые нужно обновить: UserControllerTest.findAll_WithoutFilters_ShouldReturnAllUsersWithPagination"
  note: "КРИТИЧЕСКИЙ: findAll_WithoutFilters_ShouldReturnAllUsersWithPagination ожидает size=20, нужно изменить на 10. UserServiceImplTest тесты не сломаются (явно задают PageRequest.of(0,10))"
- [x] (P1) [2025-01-21 16:15] #5: Добавить конфигурацию пагинации в application.yml — Настроены дефолтные значения пагинации через Spring Data Web
  acceptance: "Добавлены настройки: default-page-size=10, max-page-size=100, page-parameter=page, size-parameter=size"
  note: "Добавлена секция spring.data.web.pageable в application.yml с оптимальными значениями. Синтаксис YAML проверен и корректен"

### In Progress
- [ ] (P1) #6: Добавить @PageableDefault аннотацию в контроллер — Установить явные дефолтные значения в методе findAll
  acceptance: "Добавлена аннотация @PageableDefault(size = 10)"
- [ ] (P2) #7: Создать конфигурационный класс для пагинации — Создать @Configuration класс для централизованного управления настройками
  acceptance: "Создан PaginationConfig с настройками WebMvcConfigurer"

#### Тестирование
- [ ] (P1) #8: Обновить существующие тесты — Адаптировать тесты под новые дефолтные значения пагинации
  acceptance: "Обновлены тесты: findAll_WithoutFilters_ShouldReturnAllUsersWithPagination ожидает size=10 вместо 20"
- [ ] (P1) #9: Добавить тесты для дефолтной пагинации — Создать тесты для проверки работы пагинации по умолчанию
  acceptance: "Добавлены тесты: проверка дефолтного размера страницы, максимального размера"
- [ ] (P2) #10: Добавить интеграционные тесты — Проверить работу пагинации в реальных условиях
  acceptance: "Созданы тесты с реальной базой данных для проверки производительности"

#### Документация и валидация
- [ ] (P2) #11: Обновить API документацию — Обновить README.md с новыми дефолтными значениями пагинации
  acceptance: "Обновлена документация: default page size=10, max size=100"
- [ ] (P2) #12: Добавить валидацию максимального размера страницы — Защита от слишком больших запросов
  acceptance: "Добавлена валидация: максимальный размер страницы ограничен 100 элементами"

## Assumptions
- Текущая реализация использует Spring Data Web автоматическую пагинацию без явных дефолтных значений
- Дефолтный размер страницы Spring Data Web = 20 (видно из тестов)
- Клиенты API могут полагаться на текущие дефолтные значения
- Изменение дефолтных значений может повлиять на производительность и UX
- Необходимо обеспечить обратную совместимость через параметры запроса
- **НОВОЕ**: Оптимальный дефолтный размер страницы = 10 элементов (лучший UX, меньше нагрузки)
- **НОВОЕ**: Максимальный размер страницы = 100 элементов (защита от злоупотреблений)

## Notes
- **Текущая проблема**: Отсутствие явно заданных дефолтных значений пагинации
- **Риски**: 
  - Нарушение обратной совместимости для существующих клиентов
  - Возможное снижение производительности при неправильных дефолтных значениях
  - Необходимость обновления тестов и документации
- **Критерии успеха**:
  - Дефолтный размер страницы = 10 элементов
  - Максимальный размер страницы = 100 элементов  
  - Все существующие тесты проходят
  - API документация обновлена
- **Инструменты**: Spring Data Web, @PageableDefault, application.yml, JUnit 5, MockMvc
- **Технологии**: Spring Boot 3.x, Spring Data JPA, PostgreSQL, Java 24

## Риски и митигация
- **Риск**: Нарушение работы существующих клиентов
  - **Митигация**: Сохранение возможности явного указания параметров пагинации
- **Риск**: Снижение производительности при больших объемах данных
  - **Митигация**: Ограничение максимального размера страницы, мониторинг производительности
- **Риск**: Несовместимость с существующими тестами
  - **Митигация**: Поэтапное обновление тестов, проверка на CI/CD
